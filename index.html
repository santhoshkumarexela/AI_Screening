
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HirePulse AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; margin: 0; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.4",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "react/": "https://esm.sh/react@^19.2.4/",
    "@google/genai": "https://esm.sh/@google/genai@^1.41.0"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { GoogleGenAI, Type } from 'https://esm.sh/@google/genai@1.41.0';

        // The API Key is injected here by main.py
        const API_KEY = process.env.API_KEY;

        /** AI SERVICE LOGIC **/
        const ai = new GoogleGenAI({ apiKey: API_KEY });

        const screenCandidate = async (jd, resume) => {
            const response = await ai.models.generateContent({
                model: 'gemini-3-flash-preview',
                contents: `Analyze Resume against Job Description.\nJD: ${jd}\nResume: ${resume}`,
                config: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: Type.OBJECT,
                        properties: {
                            matchPercentage: { type: Type.NUMBER },
                            keyStrengths: { type: Type.ARRAY, items: { type: Type.STRING } },
                            gapAnalysis: { type: Type.ARRAY, items: { type: Type.STRING } },
                            recommendation: { type: Type.STRING },
                            suggestedQuestions: { type: Type.ARRAY, items: { type: Type.STRING } }
                        },
                        required: ["matchPercentage", "keyStrengths", "gapAnalysis", "recommendation", "suggestedQuestions"]
                    }
                }
            });
            return JSON.parse(response.text || '{}');
        };

        /** COMPONENTS **/
        const Sidebar = ({ currentView, setView }) => (
            <aside className="w-64 bg-white border-r border-slate-200 flex flex-col h-screen sticky top-0">
                <div className="p-6 flex items-center gap-3">
                    <div className="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white shadow-lg font-bold">H</div>
                    <span className="font-bold text-xl text-slate-800">HirePulse</span>
                </div>
                <nav className="flex-1 px-4 space-y-2 mt-4">
                    {['DASHBOARD', 'JOBS', 'CANDIDATES'].map(v => (
                        <button key={v} onClick={() => setView(v)} className={`w-full text-left p-3 rounded-lg ${currentView === v ? 'bg-indigo-50 text-indigo-600 font-bold' : 'text-slate-500 hover:bg-slate-50'}`}>
                            {v.charAt(0) + v.slice(1).toLowerCase()}
                        </button>
                    ))}
                </nav>
            </aside>
        );

        const App = () => {
            const [view, setView] = useState('DASHBOARD');
            const [jobs, setJobs] = useState([{ id: '1', title: 'Senior Engineer', content: 'React, Node, AI experience', createdAt: Date.now() }]);
            const [candidates, setCandidates] = useState([]);
            const [selectedJobId, setSelectedJobId] = useState('1');
            const [isProcessing, setIsProcessing] = useState(false);

            const handleAddCandidate = (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const newCandidate = {
                    id: Math.random().toString(36).substr(2, 9),
                    name: formData.get('name'),
                    email: formData.get('email'),
                    resume: formData.get('resume'),
                    status: 'pending'
                };
                setCandidates([...candidates, newCandidate]);
                e.target.reset();
            };

            const runScreening = async (candidate) => {
                const job = jobs.find(j => j.id === selectedJobId);
                if (!job) return;
                setIsProcessing(true);
                try {
                    const result = await screenCandidate(job.content, candidate.resume);
                    setCandidates(candidates.map(c => c.id === candidate.id ? { ...c, score: result.matchPercentage, analysis: result, status: 'scored' } : c));
                } catch (e) { alert("AI Error: Check API Key settings"); }
                setIsProcessing(false);
            };

            const triggerMail = (candidate) => {
                const subject = `Interview Invitation - ${jobs.find(j => j.id === selectedJobId)?.title}`;
                const body = `Hi ${candidate.name},\n\nWe were impressed by your profile and would like to invite you for an interview.`;
                window.location.href = `mailto:${candidate.email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            };

            return (
                <div className="flex bg-slate-50 min-h-screen">
                    <Sidebar currentView={view} setView={setView} />
                    <main className="flex-1 p-8 animate-fade-in">
                        {view === 'DASHBOARD' && (
                            <div className="space-y-6">
                                <h1 className="text-3xl font-bold">Recruitment Hub</h1>
                                <div className="grid grid-cols-3 gap-6">
                                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                                        <div className="text-slate-500 text-sm">Active Jobs</div>
                                        <div className="text-3xl font-bold text-indigo-600">{jobs.length}</div>
                                    </div>
                                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                                        <div className="text-slate-500 text-sm">Total Candidates</div>
                                        <div className="text-3xl font-bold text-emerald-600">{candidates.length}</div>
                                    </div>
                                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                                        <div className="text-slate-500 text-sm">Pending Review</div>
                                        <div className="text-3xl font-bold text-amber-600">{candidates.filter(c => c.status === 'pending').length}</div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'CANDIDATES' && (
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                <form onSubmit={handleAddCandidate} className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 h-fit">
                                    <h3 className="font-bold mb-4">Add Applicant</h3>
                                    <input name="name" placeholder="Name" className="w-full mb-3 p-2 border rounded" required />
                                    <input name="email" placeholder="Email" className="w-full mb-3 p-2 border rounded" required />
                                    <textarea name="resume" placeholder="Paste Resume Content" className="w-full mb-3 p-2 border rounded h-40" required />
                                    <button className="w-full bg-indigo-600 text-white p-2 rounded font-bold">Add to Pipeline</button>
                                </form>
                                <div className="lg:col-span-2 bg-white rounded-2xl border overflow-hidden">
                                    <table className="w-full text-left">
                                        <thead className="bg-slate-50">
                                            <tr>
                                                <th className="p-4">Name</th>
                                                <th className="p-4">AI Match</th>
                                                <th className="p-4">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {candidates.map(c => (
                                                <tr key={c.id} className="border-t">
                                                    <td className="p-4">{c.name}</td>
                                                    <td className="p-4 font-bold text-indigo-600">{c.score ? `${c.score}%` : 'â€”'}</td>
                                                    <td className="p-4 flex gap-2">
                                                        {c.status === 'pending' ? 
                                                            <button onClick={() => runScreening(c)} className="bg-indigo-50 text-indigo-600 px-3 py-1 rounded text-sm">Screen</button> :
                                                            <button onClick={() => triggerMail(c)} className="bg-emerald-50 text-emerald-600 px-3 py-1 rounded text-sm">Email Invite</button>
                                                        }
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {view === 'JOBS' && (
                            <div className="space-y-4">
                                <h2 className="text-2xl font-bold">Job Roles</h2>
                                {jobs.map(j => (
                                    <div key={j.id} className="bg-white p-6 rounded-xl border">
                                        <h4 className="font-bold text-lg">{j.title}</h4>
                                        <p className="text-slate-500 text-sm">{j.content}</p>
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
